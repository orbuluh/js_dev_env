#!/bin/bash

# Function to Archive a Local Branch - ga == git archive
function ga() {
  local branch_name="$1"
  local tag_name="archive/$branch_name"

  # Check if the branch exists
  if ! git show-ref --verify --quiet "refs/heads/$branch_name"; then
    echo "Branch '$branch_name' does not exist."
    return 1
  fi

  # Check if the archive tag already exists
  if git show-ref --tags --quiet "refs/tags/$tag_name"; then
    echo "Tag '$tag_name' already exists. To archive, manually delete the tag using 'git tag -d $tag_name'."
    return 1
  fi

  # Check out the branch
  git checkout "$branch_name" || return 1

  # Create an archive tag
  git tag "$tag_name" || return 1

  # Switch back to the master branch (or your default branch)
  git checkout master || return 1

  # Delete the local branch (optional)
  git branch -d "$branch_name" || return 1

  echo "Branch '$branch_name' archived as '$tag_name'."
}

# Function to Unarchive a Tag into a New Branch - gua == git un-archive
function gua() {
  local tag_name="$1"
  local new_branch_name="${tag_name#archive/}"

  # Check if the tag exists
  if ! git show-ref --tags --quiet "refs/tags/$tag_name"; then
    echo "Tag '$tag_name' does not exist."
    return 1
  fi

  # Create a new branch from the tag
  git checkout -b "$new_branch_name" "$tag_name" || return 1

  echo "Branch '$new_branch_name' created from tag '$tag_name'."
}

function gcm() {
  if git show-ref --verify --quiet refs/heads/main; then
    git checkout main
    exit 0
  fi

  # Check if master branch exists
  if git show-ref --verify --quiet refs/heads/master; then
    git checkout master
  fi

  echo "Neither main or master branch exists ... do nothing"
}

#-----------------------------------------------------------------------------

alias gs='git status'
alias gl='git log --color=always --abbrev-commit'
alias gd='git diff'
alias gdl='git diff --name-only --relative'
alias gb='git branch -vv'
alias gp='git push'
alias gcb='git checkout -b'
alias gt='git log --graph --pretty=oneline --abbrev-commit'
alias gsb='git switch -'

function gcm() {
  if git show-ref --verify --quiet refs/heads/master; then
    git checkout master
  else
    git checkout main
  fi
}
